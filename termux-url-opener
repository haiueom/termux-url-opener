#!/bin/bash

url=$1

green='\033[1;32m'
cyan='\033[1;36m'
white='\033[1;37m'
red='\033[1;31m'
yellow='\033[1;33m'
reset='\033[0m'
blue='\033[1;34m'
bar="$green—————————————————————————$reset"

echo -e "\n${white}[${blue}#${white}] Termux Downloader by ${cyan}haiueom${reset}"
echo -e "${bar}"
echo -e "${white}[${blue}#${white}] URL${red}:${white} ${cyan}${url}${reset}"
echo -e "${bar}"
echo -e "${white}[${blue}!${white}] Available Options${reset}"
echo -e "${white}[${green}+${white}] 1: Download mp4 (video)${reset}"
echo -e "${white}[${green}+${white}] 2: Download mkv (video)${reset}"
echo -e "${white}[${green}+${white}] 3: Download mp3 (audio)${reset}"
echo -e "${white}[${green}+${white}] 4: Download mp4 (video) and mp3 (audio)${reset}"
echo -e "${white}[${green}+${white}] 5: Download mkv (video) and mp3 (audio)${reset}"
echo -e "${white}[${green}+${white}] 6: Download using wget${reset}"
echo -e "${white}[${green}+${white}] 7: Download mp4 with cookies${reset}"
echo -e "${white}[${green}+${white}] x: Exit${reset}"
echo -e "${bar}"
echo -ne "${white}[${yellow}?${white}] Choose an option${red}:${cyan} "
read -r option
echo -e "${bar}"

cookie_path="$HOME/storage/downloads/termux/cookies/"
default_config_video="-f 'bv[ext=mp4/avc1]+ba[ext=m4a/mp4a]/b'"
default_config_audio="-f 'ba[ext=m4a/mp4a]/b' -x --audio-format 'mp3' --audio-quality 0"

case $option in
    1)
        echo -e "${white}[${green}*${white}] Downloading...${reset}\n"
        yt-dlp "$default_config_video" --merge-output-format 'mp4' "$url"
    ;;
    2)
        echo -e "${white}[${green}*${white}] Downloading...${reset}\n"
        yt-dlp "$default_config_video" --merge-output-format 'mkv' "$url"
    ;;
    3)
        echo -e "${white}[${green}*${white}] Downloading...${reset}\n"
        yt-dlp "$default_config_audio" "$url"
    ;;
    4)
        echo -e "${white}[${green}*${white}] Downloading...${reset}\n"
        yt-dlp "$default_config_video" --merge-output-format 'mp4' "$url"
        yt-dlp "$default_config_audio" "$url"
    ;;
    5)
        echo -e "${white}[${green}*${white}] Downloading...${reset}\n"
        yt-dlp "$default_config_video" --merge-output-format 'mkv' "$url"
        yt-dlp "$default_config_audio" "$url"
    ;;
    6)
        echo -e "${white}[${green}*${white}] Downloading...${reset}\n"
        [ -d "$HOME/storage/downloads/termux/wget" ] || mkdir "$HOME/storage/downloads/termux/wget"
        cd "$HOME/storage/downloads/termux/wget" || exit
        wget "$url"
    ;;
    7)
        case "$url" in
            *twitter.com*|*x.com*)
            echo -e "${white}[${green}*${white}] Downloading...${reset}\n"
                cookie="${cookie_path}twitter.txt"
                yt-dlp "$default_config_video" --cookies "$cookie" --merge-output-format 'mp4' "$url"
            ;;
            *)
                echo -e "${white}[${red}!${white}] Cookie not found for this site${reset}"
                sleep 3
                exit
            ;;
        esac

    ;;
    x)
        echo -e "${white}[${red}!${white}] Good bye . . .${reset}"
    ;;
    *)
        echo -e "${white}[${red}!${white}] Invalid option${reset}"
    ;;
esac

echo -e "\n${bar}\n${white}[${green}✓${white}] Done! auto close in 3 seconds . . .${reset}\n"
sleep 3
